---
kind: pipeline
type: docker
name: Default

trigger:
  event:
    - push
    - tag

steps:
  - name: Audit
    image: node:12
    commands:
      - npm audit --package-lock-only --production --audit-level=moderate

  - name: Install
    image: node:12
    environment:
      NPM_CONFIG_IGNORE_SCRIPTS: true
    commands:
      - npm install

  - name: Test
    image: node:12
    commands:
      - npm test

  # Not enough coverage
  #- name: check-coverage
  #  image: node:12
  #  commands:
  #    - npm run coverage

  - name: Build
    image: node:12
    commands:
      - npm run build
      - NPM_CONFIG_IGNORE_SCRIPTS=false npm install --production

  - name: Static-security-scan
    image: quay.io/natlibfi/njsscan
    commands:
      - njsscan dist

  - name: Npm
    image: plugins/npm
    settings:
      registry: 'https://registry.npmjs.org/'
      token:
        from_secret: npm_token
    when:
      event: tag
---
  kind: pipeline
  type: docker
  name: Update dependencies

  trigger:
    event:
      - custom
    branch:
      - master

  steps:
    - name: Publish
      image: quay.io/natlibfi/drone-npm-git-publish
      settings:
        git_user_name: natlibfi-melinda-automation
        git_user_email: 65649125+natlibfi-melinda-automation@users.noreply.github.com
        git_ssh_key:
          from_secret: ssh_key
        git_gpg_key:
          from_secret: gpg_key
---
kind: secret
name: npm_token
data: jlQBw20N3JjZuJ5yYvjj8w1jPgExKYxBFOxERRE1iW0kz81COKxY0FiN71aH0PI+sPrjA9j6BodpZG4hq9qOwA==
---
kind: secret
name: ssh_key
data: 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
---
kind: secret
name: gpg_key
data: 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
---
kind: signature
hmac: 34a6cddc530567cc17df078d0b92ec28a21cb0db154cb11a277765021ce10e55

...
